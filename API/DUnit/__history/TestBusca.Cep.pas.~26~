unit TestBusca.Cep;
{

  Delphi DUnit Test Case
  ----------------------
  This unit contains a skeleton test case class generated by the Test Case Wizard.
  Modify the generated code to correctly setup and call the methods from the unit 
  being tested.

}

interface

uses
  TestFramework, Horse,
  Busca.Cep.Controller,
  BuscaCep.Services,
  BuscaCep.Repository,
  StrUtils, sysUtils,
  REST.Client;

type
  // Test methods for class TBuscaCepController

  TestTBuscaCepController = class(TTestCase)
  strict private
   FRest : TRESTClient;
   Request : TRESTRequest;
  public
    procedure SetUp; override;
    procedure TearDown; override;
  published
    procedure TesteBuscaCep;
    procedure TesteBuscaCepInvalido;
  end;

implementation

procedure TestTBuscaCepController.SetUp;
begin
  FRest := TRESTClient.Create('http://localhost:9000/BuscarCep/12929-605');
  Request := TRESTRequest.Create(FRest);
end;

procedure TestTBuscaCepController.TearDown;
begin
  Request.Free;
  FRest.Free;
end;


procedure TestTBuscaCepController.TesteBuscaCep;
begin
    Rest.Accept := '*/*';
    Rest.AcceptCharset := 'utf-8';
    Request.Client := rest;
    Request.Execute;

    var isOk := (Request.Response.StatusCode = 200) and
                           ( not Request.Response.JSONText.Trim.IsEmpty );
    CheckTrue(isOk);

end;


procedure TestTBuscaCepController.TesteBuscaCepInvalido;
begin

end;

initialization
  // Register any test cases with the test runner
  RegisterTest(TestTBuscaCepController.Suite);
end.

